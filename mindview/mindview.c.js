String.prototype.trim=function(){return this.replace(/^\s*(\b.*\b|)\s*$/,"$1")};var g_YTree=null;YTree.prototype=new Object();YTree.prototype.constructor=YTree;YTree.superclass=Object.prototype;function YTree(){this.rootNode=null;this.rootNodeID="r";this.nodes=new Array;this.maxid=0;g_YTree=this;this.NODE_POS_ROOT=0;this.NODE_POS_LEFT=1;this.NODE_POS_RIGHT=2;this.NODE_SIB_PREV=0;this.NODE_SIB_NEXT=1;this.NODE_SWITCH_UP=0;this.NODE_SWITCH_DN=1}YTree.prototype.initTree=function(a){this.rootNode.removeChildren();this.rootNode.text=a;this.maxid=0};YTree.prototype.getYNodeTextFromXNode=function(b){var e=b.getAttribute("TEXT");if(e==undefined||e==null||e.length==0){return"untitled"}var f=e.split(/&#x/g);var d="";for(var c=0;c<f.length;c++){tok=f[c];if(tok==undefined||tok==null||tok.length==0){continue}if(tok.length==5&&tok.charAt(4)==";"){d+=String.fromCharCode((parseInt(tok.charAt(0)+tok.charAt(1),16)<<8)+(parseInt(tok.charAt(2)+tok.charAt(3),16)))}else{var a=tok.replace(/&amp;/g,"&");a=a.replace(/&quot;/g,'"');a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");d+=a}}return d};YTree.prototype.getXNodeTextFromYNode=function(d){string=d.text.replace(/\r\n/g,"\n");var b="";for(var f=0;f<string.length;f++){var e=string.charCodeAt(f);if(e<256){var a=String.fromCharCode(e);if(a=="&"){b+="&amp;"}else{if(a=='"'){b+="&quot;"}else{if(a=="<"){b+="&lt;"}else{if(a==">"){b+="&gt;"}else{b+=a}}}}}else{b+="&#x"+e.toString(16)+";"}}return b};YTree.prototype.buildYNodes=function(j,h){h.text=this.getYNodeTextFromXNode(j);for(var a=0;a<j.childNodes.length;a++){var d=j.childNodes[a];if(d.tagName=="node"){var f=d.getAttribute("POSITION");if(f=="right"){f=this.NODE_POS_RIGHT}else{f=this.NODE_POS_LEFT}var g=d.getAttribute("FOLDED");if(g=="true"){h.collapsed=true}var c=h.appendChild("",f);this.buildYNodes(d,c)}else{if(d.tagName=="font"){var e=d.getAttribute("BOLD");if(e=="true"){h.bold=true}var b=d.getAttribute("ITALIC");if(b=="true"){h.italic=true}}}}};YTree.prototype.loadFromXML=function(d){var e,b;if(window.ActiveXObject){var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(d)}else{var f=new DOMParser();e=f.parseFromString(d,"text/xml")}b=e.documentElement;for(var c=0;c<b.childNodes.length;c++){var a=b.childNodes[c];if(a.tagName=="node"){this.buildYNodes(a,this.rootNode);break}}};YTree.prototype.buildText=function(e,a){var f="";if(a){for(var c=0;c<e.indent;c++){f+="\t"}}f+=e.text+"\n";if(e.indent==0){var d=null;for(var c=0;c<e.childNodes.length;c++){var b=this.getNodeById(e.childNodes[c]);if(b&&b.pos==this.NODE_POS_RIGHT){d=b.getSiblingHead();break}}while(d){f+=this.buildText(d,a);d=d.nextNode}d=null;for(var c=0;c<e.childNodes.length;c++){var b=this.getNodeById(e.childNodes[c]);if(b&&b.pos==this.NODE_POS_LEFT){d=b.getSiblingHead();break}}while(d){f+=this.buildText(d,a);d=d.nextNode}}else{var d=null;if(e.childNodes.length>0){var b=this.getNodeById(e.childNodes[0]);if(b){d=b.getSiblingHead()}}while(d){f+=this.buildText(d,a);d=d.nextNode}}return f};YTree.prototype.exportToText=function(a){return this.buildText(this.rootNode,a)};YTree.prototype.createRootNode=function(a){this.rootNode=new YNode(null,this.NODE_POS_ROOT,a);return this.rootNode};YTree.prototype.addNode=function(a){this.nodes[a.id]=a};YTree.prototype.deleteNodeById=function(a){delete this.nodes[a]};YTree.prototype.removeNode=function(c){if(c.parentNode==null){return false}c.removeChildren();for(var a=0;a<c.parentNode.childNodes.length;a++){var b=g_YTree.getNodeById(c.parentNode.childNodes[a]);if(c.id==b.id){c.parentNode.childNodes.splice(a,1);if(c.prevNode){c.prevNode.nextNode=c.nextNode}if(c.nextNode){c.nextNode.prevNode=c.prevNode}this.deleteNodeById(c.id);return true}}return false};YTree.prototype.getNodeById=function(a){return this.nodes[a]};YTree.prototype.getNextMaxId=function(){this.maxid++;return this.maxid};YNode.prototype=new Object();YNode.prototype.constructor=YNode;YNode.superclass=Object.prototype;function YNode(a,c,b){if(a){if(this.indent==1){}this.id="_"+g_YTree.getNextMaxId();this.indent=a.indent+1}else{this.indent=0;this.id=g_YTree.rootNodeID}this.pos=c;this.text=b.trim();this.collapsed=false;this.childNodes=new Array;this.parentNode=a;this.prevNode=null;this.nextNode=null;this.lastSelectedChildID="";this.bold=false;this.italic=false;g_YTree.addNode(this)}YNode.prototype.toString=function(){return this.id};YNode.prototype.appendChild=function(j,h){var g;if(this.pos==g_YTree.NODE_POS_ROOT){if(h==undefined||h==null){var a=0;var d=0;var k=this.childNodes.length;for(var e=0;e<k;e++){var c=g_YTree.getNodeById(this.childNodes[e]);if(c.pos==g_YTree.NODE_POS_LEFT){a++}else{d++}}if(a>=d){g=g_YTree.NODE_POS_RIGHT}else{g=g_YTree.NODE_POS_LEFT}}else{g=h;if(g!=g_YTree.NODE_POS_RIGHT&&g!=g_YTree.NODE_POS_LEFT){g=g_YTree.NODE_POS_RIGHT}}}else{g=this.pos}var b=new YNode(this,g,j);var f=null;if(this.pos==g_YTree.NODE_POS_ROOT){for(var e=0;e<this.childNodes.length;e++){var c=g_YTree.getNodeById(this.childNodes[e]);if(c.pos==g){f=c;break}}}else{if(this.childNodes.length>0){f=g_YTree.getNodeById(this.childNodes[0])}}if(f!=null){while(f.nextNode!=null){f=f.nextNode}f.nextNode=b;b.prevNode=f}this.childNodes.push(b.id);return b};YNode.prototype.getSiblingHead=function(){var a=this.prevNode;if(a){while(a.prevNode!=null){a=a.prevNode}}else{a=this}return a};YNode.prototype.getChildHead=function(){if(this.childNodes.length==0){return null}return g_YTree.getNodeById(this.childNodes[0]).getSiblingHead()};YNode.prototype.getSiblingTail=function(){var a=this.nextNode;if(a){while(a.nextNode!=null){a=a.nextNode}}else{a=this}return a};YNode.prototype.getChildTail=function(){if(this.childNodes.length==0){return null}return g_YTree.getNodeById(this.childNodes[0]).getSiblingTail()};YNode.prototype.getLastSelectedChild=function(e){var c=null;var d=this.childNodes.length;if(d==0){return null}if(this.lastSelectedChildID!=""){c=g_YTree.getNodeById(this.lastSelectedChildID)}if((c==undefined||c==null)||(c.parentNode.id!=this.id||(this.indent==0&&c.pos!=e))){c=null;if(this.indent==0){for(var b=0;b<d;b++){var a=g_YTree.getNodeById(this.childNodes[b]);if(a.pos==e){c=a;break}}}else{c=g_YTree.getNodeById(this.childNodes[0])}return(c!=null)?c.getSiblingHead():null}return c};YNode.prototype.switchNode=function(a){if(a!=g_YTree.NODE_SWITCH_UP&&a!=g_YTree.NODE_SWITCH_DN){return null}var c=this.prevNode;var b=this.nextNode;if(a==g_YTree.NODE_SWITCH_UP){if(c==null){return null}if(c.prevNode){this.prevNode=c.prevNode;c.prevNode.nextNode=this}else{this.prevNode=null}if(b){c.nextNode=b;b.prevNode=c}else{c.nextNode=null}this.nextNode=c;c.prevNode=this;return c}else{if(b==null){return null}if(c){b.prevNode=c;c.nextNode=b}else{b.prevNode=null}if(b.nextNode){this.nextNode=b.nextNode;b.prevNode=this}else{this.nextNode=null}this.prevNode=b;b.nextNode=this;return b}return null};YNode.prototype.appendSibling=function(c,a){if(this.parentNode==null){return null}var b=new YNode(this.parentNode,this.pos,c);if(a==g_YTree.NODE_SIB_PREV){if(this.prevNode){this.prevNode.nextNode=b}b.prevNode=this.prevNode;b.nextNode=this;this.prevNode=b}else{if(this.nextNode){this.nextNode.prevNode=b}b.prevNode=this;b.nextNode=this.nextNode;this.nextNode=b}this.parentNode.childNodes.push(b.id);return b};YNode.prototype.changePos=function(b){for(var a=0;a<this.childNodes.length;a++){node=g_YTree.getNodeById(this.childNodes[a]);node.changePos(b)}this.pos=b};YNode.prototype.changeIndent=function(a){for(var b=0;b<this.childNodes.length;b++){node=g_YTree.getNodeById(this.childNodes[b]);node.changeIndent(a+1)}this.indent=a};YNode.prototype.detachChild=function(c){for(var a=0;a<this.childNodes.length;a++){if(this.childNodes[a]==c.id){var d=c.prevNode;var b=c.nextNode;c.parentNode=null;c.prevNode=null;c.nextNode=null;if(d){d.nextNode=b}if(b){b.prevNode=d}this.childNodes.splice(a,1);return true}}return false};YNode.prototype.removeChildren=function(c){for(var a=this.childNodes.length-1;a>=0;a--){var b=g_YTree.nodes[this.childNodes[a]];if(c!=undefined&&b.pos!=c){continue}this.childNodes.splice(a,1);b.removeChildren(c);g_YTree.deleteNodeById(b.id)}};YNode.prototype.isChildren=function(b){for(var a=0;a<this.childNodes.length;a++){node=g_YTree.getNodeById(this.childNodes[a]);if(node.id==b||node.isChildren(b)==true){return true}}return false};YNode.prototype.attachToNode=function(e,f){if(this.parentNode==null){return false}var d=null;if(e.indent==0){if(this.indent==1&&this.pos==f){return false}var a=e.childNodes.length;for(var b=0;b<a;b++){var c=g_YTree.getNodeById(e.childNodes[b]);if(c.pos==f){d=c;break}}}else{if(this.id==e.id||this.parentNode.id==e.id||this.isChildren(e.id)){return false}if(e.childNodes.length>0){d=g_YTree.getNodeById(e.childNodes[0])}}if(d!=null){while(d.nextNode!=null){d=d.nextNode}}if(!this.parentNode.detachChild(this)){return false}e.childNodes.push(this.id);if(d){d.nextNode=this}this.parentNode=e;this.prevNode=d;this.nextNode=null;if(this.pos!=f){this.changePos(f)}if(this.indent!=(e.indent+1)){this.changeIndent(e.indent+1)}return true};YNode.prototype.toggleBold=function(a){if(a!=undefined){this.bold=a}this.bold=!this.bold};YNode.prototype.toggleItalic=function(a){if(a!=undefined){this.italic=a}this.italic=!this.italic};var g_YView=null;YView.prototype=new Object();YView.prototype.constructor=YView;YView.superclass=Object.prototype;function YView(a,b,c){this.tree=a;this.panelD=b;this.panelV=c;this.rootPosX=b.offsetWidth/2;this.rootPosY=300;this.selectedNodes=new Array;this.lastSelectedNodeID="";this.attributes=new Array;this.bNodeEditing=false;this.CARET_ORG_START=0;this.CARET_ORG_END=1;this.NODE_NAV_PAGEUP=33;this.NODE_NAV_PAGEDN=34;this.NODE_NAV_LEFT=37;this.NODE_NAV_UP=38;this.NODE_NAV_RIGHT=39;this.NODE_NAV_DOWN=40;this.NODE_DIV_PREFIX="DIV";this.NODE_DIV_HGAP=20;this.NODE_DIV_VGAP=3;this.NODE_DIV_SELCOLOR="#D0D0D0";this.NODE_STYLE_BOLD=0;this.NODE_STYLE_ITALIC=1;this.NODE_LINK_PREFIX="LNK";this.NODE_LNK_WIDTH=1;this.NODE_LNK_COLOR="gray";this.ROOT_SHAPE_ID="V_ROOT";this.ROOT_SHAPE_HEIGHT=60;this.ROOT_SHAPE_STCOLOR="gray";this.ROOT_SHAPE_COLOR="white";this.ROOT_SHAPE_SELCOLOR="#D0D0D0";this.SVG_NAMESPACE="http://www.w3.org/2000/svg";this.SVG_RIGHTGRADIENT_ID="V_RGRA_ID";this.SVG_LEFTGRADIENT_ID="V_LGRA_ID";this.SVG_NUTRALGRADIENT_ID="V_NGRA_ID";this.ICON_PATH="icons";this.UIIMG_PATH="ui";this.TOOLBAR_BAND_HEIGHT=28;this.TOOLBAR_MAIN_ID="toolbarMain";this.TOOLBAR_TITLE_ID="toolbarTitle";this.TOOLBAR_ICON_ID="toolbarIcon";this.CONTENT_VIEW_ID="contentView";this.CONTENT_FORM_ID="contentForm";this.CONTENT_TEXT_ID="contentText";this.dragObject=null;this.dragPos=0;this.dragOldLeft=0;this.dragOldTop=0;this.mouseOffset=null;if(window.HTMLElement){this.createSVGElement()}this.bEditingLock=false;this.bPermanentLock=false;g_YView=this;this.centerPanelView();if(document.all){b.onselectstart=function(){return(g_YView.bNodeEditing)?true:false}}b.onclick=function(){if(!g_YView.bNodeEditing){makeDraggable(b)}}}YView.prototype.setAttribute=function(a,b){this.attributes[a]=b};YView.prototype.getAttribute=function(a){if(this.attributes[a]==undefined||this.attributes[a]==null){return null}return this.attributes[a]};YView.prototype.removeAttribute=function(a){if(this.attributes[a]==undefined||this.attributes[a]==null){return null}val=this.attributes[a];delete this.attributes[a];return val};YView.prototype.isLockEditing=function(){return this.bEditingLock};YView.prototype.lockEditing=function(){this.bEditingLock=true};YView.prototype.unLockEditing=function(){if(this.bPermanentLock){return}this.bEditingLock=false};YView.prototype.isPermanentLocked=function(){return this.bPermanentLock};YView.prototype.setPermanentLock=function(b){this.bPermanentLock=b;if(b){var a=document.getElementById(this.TOOLBAR_TITLE_ID);if(a){a.readOnly=true}}else{var a=document.getElementById(this.TOOLBAR_TITLE_ID);if(a){a.readOnly=false}}};YView.prototype.toggleContentView=function(){var a=document.getElementById(this.CONTENT_VIEW_ID);if(a==null){return false}if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}};YView.prototype.importMap=function(){var a='<?xml version="1.0" encoding="UTF-8"?>'+this.getContentViewText();this.initMap("New MindWeb");this.tree.loadFromXML(a);this.redrawTree()};YView.prototype.setContentTitle=function(b){var a=document.getElementById(this.TOOLBAR_TITLE_ID);if(a==null){return}a.value=b};YView.prototype.getContentTitle=function(){var a=document.getElementById(this.TOOLBAR_TITLE_ID);if(a==null){return""}return a.value};YView.prototype.setContentViewText=function(b){var a=document.getElementById(this.CONTENT_FORM_ID);if(a==null){return}a.childNodes[0].value=b};YView.prototype.getContentViewText=function(){var a=document.getElementById(this.CONTENT_FORM_ID);if(a==null){return""}return a.childNodes[0].value};YView.prototype.centerPanelView=function(){if(document.all){var a=2048;var b=4096;this.panelD.style.width=a+"px";this.panelD.style.height=b+"px";this.panelD.style.left=parseInt((document.body.clientWidth-a)/2,10)+"px";this.panelD.style.top=0-(b/2)+300+"px"}};YView.prototype.createSVGElement=function(){var c=document.createElementNS(this.SVG_NAMESPACE,"marker");c.setAttribute("id","EndMarker");c.setAttribute("markerUnits","userSpaceOnUse");c.setAttribute("viewBox","0 0 16 16");c.setAttribute("refX","0");c.setAttribute("refY","8");c.setAttribute("fill",this.NODE_LNK_COLOR);if(this.NODE_LNK_WIDTH==1){c.setAttribute("markerWidth",this.NODE_LNK_WIDTH*8)}else{c.setAttribute("markerWidth",this.NODE_LNK_WIDTH*4)}c.setAttribute("markerHeight",this.NODE_LNK_WIDTH*8);c.setAttribute("orient","auto");this.panelV.appendChild(c);var a=document.createElementNS(this.SVG_NAMESPACE,"circle");a.setAttribute("cx","8");a.setAttribute("cy","8");a.setAttribute("r","8");a.setAttribute("r","8");c.appendChild(a);var e=new Array(3);var f=new Array(this.SVG_RIGHTGRADIENT_ID,this.SVG_LEFTGRADIENT_ID,this.SVG_NUTRALGRADIENT_ID);var d=new Array(6);for(var b=0;b<e.length;b++){e[b]=document.createElementNS(this.SVG_NAMESPACE,"linearGradient");e[b].setAttribute("id",f[b]);d[b*2]=document.createElementNS(this.SVG_NAMESPACE,"stop");d[b*2+1]=document.createElementNS(this.SVG_NAMESPACE,"stop");d[b*2].setAttribute("offset","0%");d[b*2+1].setAttribute("offset","100%");e[b].appendChild(d[b*2]);e[b].appendChild(d[b*2+1]);this.panelV.appendChild(e[b])}d[0].setAttribute("stop-color",this.ROOT_SHAPE_COLOR);d[1].setAttribute("stop-color",this.ROOT_SHAPE_SELCOLOR);d[2].setAttribute("stop-color",this.ROOT_SHAPE_SELCOLOR);d[3].setAttribute("stop-color",this.ROOT_SHAPE_COLOR);d[4].setAttribute("stop-color",this.ROOT_SHAPE_SELCOLOR);d[5].setAttribute("stop-color",this.ROOT_SHAPE_SELCOLOR)};YView.prototype.initMap=function(a){this.deleteNodeView(this.tree.rootNode);this.tree.initTree(a);delete this.selectedNodes;this.selectedNodes=new Array;this.lastSelectedNodeID="";this.bNodeEditing=false;this.redrawTree();this.selectNode(this.tree.rootNode,false)};YView.prototype.getSelectedNodeCount=function(){return this.selectedNodes.length};YView.prototype.getLastSelectedNode=function(){return(this.lastSelectedNodeID=="")?null:this.tree.getNodeById(this.lastSelectedNodeID)};YView.prototype.isSelectedNode=function(b){for(var a=this.selectedNodes.length-1;a>=0;a--){if(this.selectedNodes[a]==b.id){return true}}return false};YView.prototype.deSelectNodes=function(c){for(var b=this.selectedNodes.length-1;b>=0;b--){nodeID=this.selectedNodes[b];if(c!=undefined&&c!=null&&nodeID!=c.id){continue}this.selectedNodes.splice(b,1);if(nodeID==this.tree.rootNodeID){var d=document.getElementById(this.ROOT_SHAPE_ID);if(d==null){continue}if(document.all){d.setAttribute("filled","f")}else{d.setAttribute("fill","none")}}else{var a=document.getElementById(this.NODE_DIV_PREFIX+nodeID);if(a==null){continue}a.style.backgroundColor=""}if(c!=undefined&&c!=null&&nodeID==c.id){if(this.lastSelectedNodeID==nodeID){if(this.selectedNodes.length>0){this.lastSelectedNodeID=this.selectedNodes[this.selectedNodes.length-1]}else{this.lastSelectedNodeID=""}}return}}};YView.prototype.selectNode=function(f,b,h){var e=this.tree.getNodeById(f);if(e==undefined||e==null){return}if(this.lastSelectedNodeID==f&&f!=this.tree.rootNodeID){return}if(!b){this.deSelectNodes()}if(f==this.tree.rootNodeID){var g=document.getElementById(this.ROOT_SHAPE_ID);if(g==null){return}if(document.all){g.setAttribute("filled","t");if(g.childNodes.length>0){var a=g.childNodes[0];if(h==undefined||h==this.tree.NODE_POS_ROOT){a.setAttribute("color",this.ROOT_SHAPE_SELCOLOR);a.setAttribute("color2",this.ROOT_SHAPE_SELCOLOR)}else{if(h==this.tree.NODE_POS_RIGHT){a.setAttribute("color",this.ROOT_SHAPE_SELCOLOR);a.setAttribute("color2",this.ROOT_SHAPE_COLOR)}else{a.setAttribute("color",this.ROOT_SHAPE_COLOR);a.setAttribute("color2",this.ROOT_SHAPE_SELCOLOR)}}}else{g.setAttribute("fillcolor",this.NODE_DIV_SELCOLOR)}}else{if(h==undefined||h==this.tree.NODE_POS_ROOT){g.setAttribute("fill","url(#"+this.SVG_NUTRALGRADIENT_ID+")")}else{if(h==this.tree.NODE_POS_RIGHT){g.setAttribute("fill","url(#"+this.SVG_RIGHTGRADIENT_ID+")")}else{g.setAttribute("fill","url(#"+this.SVG_LEFTGRADIENT_ID+")")}}}}else{var c=this.getNodeDiv(e);if(c==null){return}c.style.backgroundColor=this.NODE_DIV_SELCOLOR}for(var d=0;d<this.selectedNodes.length;d++){if(this.selectedNodes[d]==f){return}}this.selectedNodes.push(f);this.lastSelectedNodeID=f;if(e.parentNode){e.parentNode.lastSelectedChildID=f}};YView.prototype.setNodeDivContent=function(d,b){for(var c=b.childNodes.length-1;c>=0;c--){b.removeChild(b.childNodes[c])}var f=document.createElement("span");if(f==null){return}var e=(d.text.length==0)?"_":d.text;if(document.all){f.innerText=e}else{f.textContent=e}if(d.bold){f.style.fontWeight="bold"}else{f.style.fontWeight="normal"}if(d.italic){f.style.fontStyle="italic"}else{f.style.fontStyle="normal"}f.style.height="18px";b.appendChild(f);if(d.pos==this.tree.NODE_POS_LEFT){var a=this.getNodeDiv(d.parentNode);b.style.left=a.offsetLeft-b.offsetWidth-this.NODE_DIV_HGAP+"px"}};YView.prototype.redrawNodeDivStyle=function(c){var b=this.getNodeDiv(c);if(b==null){return}var a=b.lastChild;if(c.bold){a.style.fontWeight="bold"}else{a.style.fontWeight="normal"}if(c.italic){a.style.fontStyle="italic"}else{a.style.fontStyle="normal"}};YView.prototype.getNodeDiv=function(b){if(b==null){return null}var a=document.getElementById(this.NODE_DIV_PREFIX+b.id);if(a){return a}a=document.createElement("div");if(a==null){return null}var d="NodeClick(event,'"+b.id+"')";var c="NodeDblClick(event,'"+b.id+"')";var e="NodeContextMenu(event,'"+b.id+"')";if(document.all){str='<div id="'+this.NODE_DIV_PREFIX+b.id+'" nodeID="'+b.id+'" onclick="'+d+'" ondblclick="'+c+'" oncontextmenu="'+e+'" onselectstart="return true;"></div>';this.panelD.appendChild(a);a.outerHTML=str;a=document.getElementById(this.NODE_DIV_PREFIX+b.id)}else{a.setAttribute("id",this.NODE_DIV_PREFIX+b.id);a.setAttribute("nodeID",b.id);a.setAttribute("ondblclick",c);a.setAttribute("oncontextmenu",e);a.setAttribute("nodeid",b.id);this.panelD.appendChild(a)}a.className="nodeDiv";this.setNodeDivContent(b,a);return a};YView.prototype.drawRootShape=function(a){if(document.all){var b=document.getElementById(this.ROOT_SHAPE_ID);if(b==null){b=document.createElement("v:oval");if(b==null){return}b.setAttribute("id",this.ROOT_SHAPE_ID);b.style.position="absolute";b.setAttribute("stroked","true");oFill=document.createElement("v:fill");if(oFill!=null){oFill.setAttribute("type","gradient");oFill.setAttribute("angle",90);oFill.setAttribute("color",this.ROOT_SHAPE_COLOR);oFill.setAttribute("color2",this.ROOT_SHAPE_COLOR);b.appendChild(oFill)}this.panelV.appendChild(b)}b.style.left=a.offsetLeft;b.style.top=a.offsetTop-parseInt((this.ROOT_SHAPE_HEIGHT-a.offsetHeight)/2,10);b.style.pixelWidth=a.offsetWidth;b.style.pixelHeight=this.ROOT_SHAPE_HEIGHT;b.setAttribute("strokecolor",this.ROOT_SHAPE_STCOLOR);b.setAttribute("strokeweight",this.NODE_LNK_WIDTH)}else{var b=document.getElementById(this.ROOT_SHAPE_ID);if(b==null){b=document.createElementNS(this.SVG_NAMESPACE,"ellipse");if(b==null){return}b.setAttribute("id",this.ROOT_SHAPE_ID);b.setAttribute("fill","none");this.panelV.appendChild(b)}b.setAttribute("cx",(a.offsetLeft+parseInt(a.offsetWidth/2,10)));b.setAttribute("cy",(a.offsetTop+parseInt(a.offsetHeight/2,10)));b.setAttribute("rx",parseInt(a.offsetWidth/2,10));b.setAttribute("ry",parseInt(this.ROOT_SHAPE_HEIGHT/2,10));b.setAttribute("stroke",this.ROOT_SHAPE_STCOLOR);b.setAttribute("stroke-width",this.NODE_LNK_WIDTH)}};YView.prototype.drawNodeLinker=function(o){if(o.parentNode==null){return}var h=this.getNodeDiv(o);var k=this.getNodeDiv(o.parentNode);if(h==null||k==null){return}var e=null;var c,a,j,i;var f,b;var n,m,s,r;var p=0;if(o.pos==this.tree.NODE_POS_RIGHT){c=k.offsetLeft+k.offsetWidth}else{c=k.offsetLeft}var a=k.offsetTop+((o.parentNode.indent==0)?parseInt(k.offsetHeight/2,10):k.offsetHeight)-1;i=h.offsetTop+h.offsetHeight-1;f=this.NODE_DIV_HGAP;if(o.childNodes.length>0&&o.collapsed){p=8}if(document.all){e=document.getElementById(this.NODE_LINK_PREFIX+o.id);if(e==null){e=document.createElement("v:shape");if(e==null){return null}e.setAttribute("id",this.NODE_LINK_PREFIX+o.id);e.setAttribute("coordorigin","0 0");e.setAttribute("coordsize","100 100");e.setAttribute("filled","f");e.className="linker";var g=document.createElement("v:stroke");if(g){e.appendChild(g)}this.panelV.appendChild(e)}j=h.offsetLeft;n=10;s=0;if(a>i){b=i-a}else{b=i-a}m=parseInt(b/5,10);r=b;e.style.left=c+"px";e.style.top=a+"px";e.style.pixelWidth=(o.pos==this.tree.NODE_POS_RIGHT)?100:-100;e.style.pixelHeight=100;e.setAttribute("strokecolor",this.NODE_LNK_COLOR);e.setAttribute("strokeweight",this.NODE_LNK_WIDTH);if(e.children.length>0){if(p>0){e.children[0].setAttribute("endarrow","oval")}else{e.children[0].setAttribute("endarrow","none")}}var l="m 0,0 c ";l+=n+","+m+","+s+","+r+",";l+=f+","+b+" r ";l+=(h.offsetWidth+p)+",0 e";e.setAttribute("path",l);return e}else{e=document.getElementById(this.NODE_LINK_PREFIX+o.id);if(e==null){e=document.createElementNS(this.SVG_NAMESPACE,"path");if(e==null){return}e.setAttribute("id",this.NODE_LINK_PREFIX+o.id);e.setAttribute("fill","none");this.panelV.appendChild(e)}if(o.pos==this.tree.NODE_POS_RIGHT){j=h.offsetLeft;n=c+10}else{j=h.offsetLeft+h.offsetWidth;n=c-10}m=a;s=c;r=i;if(p>0){e.setAttribute("marker-end","url(#EndMarker)")}else{e.setAttribute("marker-end","none")}e.setAttribute("stroke",this.NODE_LNK_COLOR);e.setAttribute("stroke-width",this.NODE_LNK_WIDTH);var q="M"+c+","+a+" C"+n+","+m+" "+s+","+r+" "+j+","+i+" L";if(o.pos==this.tree.NODE_POS_RIGHT){q+=(j+h.offsetWidth+p)}else{q+=(j-h.offsetWidth-p)}q+=","+i;e.setAttribute("d",q);return e}return null};YView.prototype.getNodeHeight=function(d,e){if(d.childNodes.length==0||d.collapsed){oDiv=this.getNodeDiv(d);if(oDiv){return oDiv.offsetHeight}else{return 0}}var a=0;var b=0;for(var c=0;c<d.childNodes.length;c++){cnode=this.tree.getNodeById(d.childNodes[c]);if(cnode.pos!=e){continue}b++;a+=this.getNodeHeight(cnode,e)}a+=(b-1)*this.NODE_DIV_VGAP;return a};YView.prototype.drawChildNodes=function(c){var a=this.getNodeDiv(c);if(a==null){return}var b;var j;if(c.childNodes.length==0||c.collapsed){return}else{var e=new Array(null,null);if(c.pos==this.tree.NODE_POS_ROOT){for(var g=0;g<c.childNodes.length;g++){var d=this.tree.getNodeById(c.childNodes[g]);if(d.pos==this.tree.NODE_POS_RIGHT){e[1]=d;break}}for(var g=0;g<c.childNodes.length;g++){var d=this.tree.getNodeById(c.childNodes[g]);if(d.pos==this.tree.NODE_POS_LEFT){e[0]=d;break}}}else{if(c.pos==this.tree.NODE_POS_RIGHT){e[1]=this.tree.getNodeById(c.childNodes[0])}else{if(c.pos==this.tree.NODE_POS_LEFT){e[0]=this.tree.getNodeById(c.childNodes[0])}}}for(var g=0;g<2;g++){var f=e[g];if(f==null){continue}var l=(g==0)?this.tree.NODE_POS_LEFT:this.tree.NODE_POS_RIGHT;while(f.prevNode!=null){f=f.prevNode}b=a.offsetLeft+a.offsetWidth+this.NODE_DIV_HGAP;j=a.offsetTop-parseInt((this.getNodeHeight(c,l)-a.offsetHeight)/2,10)-((c.indent==0)?parseInt(a.offsetHeight/2,10):0);var h;while(f!=null){var k=this.getNodeDiv(f);if(k==null){return}this.setNodeDivContent(f,k);h=parseInt((this.getNodeHeight(f,l)-k.offsetHeight)/2,10);if(g==0){b=a.offsetLeft-k.offsetWidth-this.NODE_DIV_HGAP}k.style.left=b+"px";k.style.top=j+h+"px";j+=(h*2)+k.offsetHeight+this.NODE_DIV_VGAP;this.drawNodeLinker(f);if(!f.collapsed){this.drawChildNodes(f)}f=f.nextNode}}}};YView.prototype.drawNode=function(c,b){var a=this.getNodeDiv(c);if(a==null){return}if(c.parentNode==null){var e=this.panelD.offsetWidth/2;var d=this.panelD.offsetHeight/2;a.style.left=(e-parseInt(a.offsetWidth/2,10))+"px";a.style.top=d+"px";a.style.paddingLeft=10+"px";a.style.paddingRight=10+"px";a.style.backgroundColor="";a.style.border="none";this.setNodeDivContent(c,a)}else{this.setNodeDivContent(c,a);this.drawNodeLinker(c)}if(b){this.drawChildNodes(c)}if(c.parentNode==null){this.drawRootShape(a)}else{}};YView.prototype.setCaretPos=function(b,c){if(document.selection){b.focus();var a=document.selection.createRange();a.moveStart("character",-b.value.length);a.moveStart("character",c);a.moveEnd("character",0);a.select()}else{if(b.selectionStart||b.selectionStart=="0"){b.selectionStart=c;b.selectionEnd=c;b.focus()}}};YView.prototype.startNodeEdit=function(c,l){var b=this.getNodeDiv(c);if(b==null){return}var j=b.lastChild;var a=j.offsetWidth+20;var k=j.offsetHeight+4;var e=c.text;b.removeChild(b.lastChild);var f=document.createElement("input");var g="nodeEdit";var i="NodeEditEnd(this,'"+c.id+"')";var d="if (keyCheck(event,[13,27])) NodeEditEnd(this,'"+c.id+"');";if(document.all){var h="<input type='text' class='"+g+"' value='"+e+"' style='width:"+a+";height:"+k+";' onblur=\""+i+'" onkeypress="'+d+'">';b.appendChild(f);f.outerHTML=h;f=b.lastChild}else{f.setAttribute("type","text");f.setAttribute("value",e);f.setAttribute("onblur",i);f.setAttribute("onkeypress",d);f.className=g;f.style.width=a+"px";f.style.height=k+"px";b.appendChild(f)}f.focus();if(l!=undefined&&l==this.CARET_ORG_START){this.setCaretPos(f,0)}else{if(l!=undefined&&l==this.CARET_ORG_END){this.setCaretPos(f,e.length)}else{f.select()}}this.panelD.onmousedown=null;this.bNodeEditing=true};YView.prototype.stopNodeEdit=function(b){var a=this.getNodeDiv(b);var c=a.lastChild;b.text=c.value.trim();this.setNodeDivContent(b,a);this.drawNode(b,true);this.bNodeEditing=false};YView.prototype.redrawTree=function(){this.drawNode(this.tree.rootNode,true)};YView.prototype.appendChildNode=function(b){var a=b.appendChild("");if(a!=null){if(b.collapsed){this.toggleNode(b)}this.redrawTree();this.selectNode(a.id,false)}return a};YView.prototype.appendSiblingNode=function(c,a){if(c.indent==0){return null}var b=c.appendSibling("",a);if(b==null){return null}this.redrawTree();this.selectNode(b.id,false);return b};YView.prototype.deleteNodeView=function(e){for(var c=e.childNodes.length-1;c>=0;c--){var d=this.tree.getNodeById(e.childNodes[c]);if(d==undefined||d==null){continue}this.deleteNodeView(d)}var b=document.getElementById(this.NODE_DIV_PREFIX+e.id);var a=document.getElementById(this.NODE_LINK_PREFIX+e.id);if(b!=null){if(document.all){b.removeNode(true)}else{this.panelD.removeChild(b)}}if(a!=null){if(document.all){a.removeNode(true)}else{this.panelV.removeChild(a)}}};YView.prototype.deleteNode=function(a){if(a.indent==0){return false}this.deleteNodeView(a);this.tree.removeNode(a);return true};YView.prototype.isSelectedNode=function(b){if(b==null){return false}for(var a=0;a<this.selectedNodes.length;a++){if(this.selectedNodes[a]==b.id){return true}}return false};YView.prototype.getNearestUnSelectedNode=function(d){if(d==null){return this.tree.rootNode}var b=d.parentNode;var c=d.prevNode;var a=d.nextNode;while(b&&b.indent!=0){if(!this.isSelectedNode(b)){b=b.parentNode;continue}return this.getNearestUnSelectedNode(b)}while(a){if(this.isSelectedNode(a)){a=a.nextNode;continue}return a}while(c){if(this.isSelectedNode(c)){c=c.prevNode;continue}return c}return d.parentNode};YView.prototype.deleteSelectedNodes=function(){var e=0;var b=this.getLastSelectedNode();if(b==null){return}var d=this.getNearestUnSelectedNode(b);for(var a=this.selectedNodes.length-1;a>=0;a--){var c=this.tree.getNodeById(this.selectedNodes[a]);this.selectedNodes.splice(a,1);if(c==undefined||c==null){continue}if(this.deleteNode(c)){e++}}this.lastSelectedNodeID="";if(e>0){this.redrawTree();this.selectNode(d,false)}};YView.prototype.swapSibNode=function(b){if(this.lastSelectedNodeID==""){return}var a=this.tree.getNodeById(this.lastSelectedNodeID);if(a==undefined||a==null||a.indent==0){return}var c=null;if(b==this.NODE_NAV_UP){c=a.prevNode;if(c==null){return}if(a.nextNode){c.nextNode=a.nextNode;a.nextNode.prevNode=c}else{c.nextNode=null}if(c.prevNode){c.prevNode.nextNode=a;a.prevNode=c.prevNode}else{a.prevNode=null}a.nextNode=c;c.prevNode=a}else{if(b==this.NODE_NAV_DOWN){c=a.nextNode;if(c==null){return}if(a.prevNode){c.prevNode=a.prevNode;a.prevNode.nextNode=c}else{c.prevNode=null}if(c.nextNode){c.nextNode.prevNode=a;a.nextNode=c.nextNode}else{a.nextNode=null}a.prevNode=c;c.nextNode=a}else{return}}this.drawNode(a.parentNode,true)};YView.prototype.navigateNode=function(a,d){if(this.lastSelectedNodeID==""){return}var c=this.tree.getNodeById(this.lastSelectedNodeID);if(c==undefined||c==null){return}if(a==this.NODE_NAV_PAGEUP){this.selectNode(c.getSiblingHead(),d)}else{if(a==this.NODE_NAV_PAGEDN){this.selectNode(c.getSiblingTail(),d)}else{if(a==this.NODE_NAV_UP){if(c.prevNode==null){if(c.parentNode!=null&&c.parentNode.prevNode!=null){if(c.parentNode.prevNode.collapsed){this.selectNode(c.parentNode.prevNode.id,d);return}var b=c.parentNode.prevNode.getChildTail();if(b!=null){this.selectNode(b.id,d);if(b.parentNode.collapsed){this.toggleNode(b.parentNode)}}}return}this.selectNode(c.prevNode.id,d)}else{if(a==this.NODE_NAV_DOWN){if(c.nextNode==null){if(c.parentNode!=null&&c.parentNode.nextNode!=null){if(c.parentNode.nextNode.collapsed){this.selectNode(c.parentNode.nextNode.id,d);return}var b=c.parentNode.nextNode.getChildHead();if(b!=null){this.selectNode(b.id,d);if(b.parentNode.collapsed){this.toggleNode(b.parentNode)}}}return}this.selectNode(c.nextNode.id,d)}else{if(a==this.NODE_NAV_RIGHT){if(c.pos==this.tree.NODE_POS_LEFT){this.selectNode(c.parentNode.id,d)}else{if(c.collapsed){this.toggleNode(c);return}var b=c.getLastSelectedChild(this.tree.NODE_POS_RIGHT);if(b==null){return}this.selectNode(b.id,d)}}else{if(a==this.NODE_NAV_LEFT){if(c.pos==this.tree.NODE_POS_RIGHT){this.selectNode(c.parentNode.id,d)}else{if(c.collapsed){this.toggleNode(c);return}var b=c.getLastSelectedChild(this.tree.NODE_POS_LEFT);if(b==null){return}this.selectNode(b.id,d)}}else{return}}}}}}};YView.prototype.toggleChild=function(f,c){var b,a;for(var d=0;d<f.childNodes.length;d++){var e=g_YTree.getNodeById(f.childNodes[d]);if(e==null){continue}b=document.getElementById(this.NODE_DIV_PREFIX+e.id);a=document.getElementById(this.NODE_LINK_PREFIX+e.id);if(b==null||a==null){continue}if(c){b.style.display="";a.style.display=""}else{b.style.display="none";a.style.display="none"}if(!e.collapsed){this.toggleChild(e,c)}}};YView.prototype.toggleNode=function(a){a.collapsed=(a.collapsed)?false:true;this.toggleChild(a,!a.collapsed);this.redrawTree()};YView.prototype.toggleNodeStyle=function(e){var c=this.getLastSelectedNode();if(c==null){return}var b;if(e==this.NODE_STYLE_BOLD){b=!c.bold}else{if(e==this.NODE_STYLE_ITALIC){b=!c.italic}else{return}}for(var a=this.selectedNodes.length-1;a>=0;a--){var d=this.tree.getNodeById(this.selectedNodes[a]);if(d==undefined||d==null){continue}if(e==this.NODE_STYLE_BOLD){d.bold=b}else{if(e==this.NODE_STYLE_ITALIC){d.italic=b}}this.redrawNodeDivStyle(d)}};function keyCheck(a,b){a=(a)?a:window.event;code=(a.keyCode)?a.keyCode:a.charCode;for(var c=0;c<b.length;c++){if(b[c]==code){return true}}return false}function getMouseOffset(d,b){b=b||window.event;var c=getPosition(d);var a=mouseCoords(b);return{x:a.x-c.x,y:a.y-c.y}}function mouseCoords(a){if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}}function getPosition(c){var b=0;var a=0;while(c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop;c=c.offsetParent}b+=c.offsetLeft;a+=c.offsetTop;return{x:b,y:a}}function mouseMove(b){b=b||window.event;var a=mouseCoords(b);if(g_YView.dragObject&&!g_YView.bNodeEditing&&(g_YView.getSelectedNodeCount()==1||g_YView.dragObject.getAttribute("nodeID")==null)){var c=0;var d=0;if(g_YView.dragObject.getAttribute("nodeID")!=null){c=0-g_YView.panelD.offsetTop+25;d=0-g_YView.panelD.offsetLeft}g_YView.dragObject.style.position="absolute";g_YView.dragObject.style.top=(a.y-g_YView.mouseOffset.y+c)+"px";g_YView.dragObject.style.left=(a.x-g_YView.mouseOffset.x+d)+"px"}if(g_YView.dragObject){g_YView.panelD.style.cursor="move"}}function mouseUp(a){a=a||window.event;if(g_YView.dragObject!=null&&g_YView.getSelectedNodeCount()==1){var b=g_YView.tree.getNodeById(g_YView.dragObject.getAttribute("nodeID"));if(b!=null&&b.id==g_YView.lastSelectedNodeID){g_YView.dragObject.style.left=g_YView.dragOldLeft+"px";g_YView.dragObject.style.top=g_YView.dragOldTop+"px";g_YView.dragObject=null;g_YView.panelD.style.cursor="default";return false}var d=g_YView.getLastSelectedNode();if(b!=null&&d!=null&&b.id!=d.id){var c=false;mousePos=mouseCoords(a);oDiv=g_YView.getNodeDiv(d);divPos=getPosition(oDiv);if((mousePos.x>divPos.x&&mousePos.x<divPos.x+oDiv.offsetWidth)&&(mousePos.y>divPos.y&&mousePos.y<divPos.y+oDiv.offsetHeight)){if(d.indent==0){c=b.attachToNode(d,g_YView.dragPos)}else{c=b.attachToNode(d,d.pos)}}if(c){if(d.collapsed){g_YView.toggleNode(d)}else{g_YView.redrawTree()}}else{g_YView.dragObject.style.left=g_YView.dragOldLeft+"px";g_YView.dragObject.style.top=g_YView.dragOldTop+"px"}}}g_YView.dragObject=null;g_YView.panelD.style.cursor="default";return false}function makeDraggable(a){if(!a){return false}a.onmousedown=function(b){g_YView.dragObject=this;g_YView.dragOldLeft=a.offsetLeft;g_YView.dragOldTop=a.offsetTop;g_YView.mouseOffset=getMouseOffset(this,b);b=b||window.event;if(document.all){b.cancelBubble=true}else{b.stopPropagation()}return false};return true}function getRelPath(a){var b=a.split("/");return b[b.length-1]}document.onmousemove=mouseMove;document.onmouseup=mouseUp;if(document.all){}else{var element=HTMLElement.prototype;var capture=["click","mousedown","mouseup","mousemove","mouseover","mouseout"];element.setCapture=function(){var b=this;var a=false;this._capture=function(f){if(a){return}a=true;var d=document.createEvent("MouseEvents");d.initMouseEvent(f.type,f.bubbles,f.cancelable,f.view,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget);b.dispatchEvent(d);a=false};for(var c=0;c<capture.length;c++){window.addEventListener(capture[c],this._capture,true)}};element.releaseCapture=function(){for(var a=0;a<capture.length;a++){window.removeEventListener(capture[a],this._capture,true)}this._capture=null}};